import{a as b,b as q}from"./chunk-WJNXT7UM.js";import{a as V,b as z}from"./chunk-XVH7M5KU.js";import{a as F}from"./chunk-BWOY3LQF.js";import"./chunk-QZNUJNV4.js";import{Eb as T,Fb as S,Hb as l,Jb as C,Kb as I,Pa as i,Va as o,Wa as P,Y as f,_a as w,da as u,ea as _,fb as x,ka as D,lb as E,mb as M,pb as d,qb as c,rb as a,sa as O,ub as y,wb as R,xb as m}from"./chunk-GSBCVLF7.js";import"./chunk-WWX6BADO.js";var A=["cameraDetection"];function L(n,g){if(n&1&&(c(0,"h1"),l(1),a()),n&2){let t=m();i(),I('Hai perso, dovevi fare una faccia "',t.targetExpression().label,'" invece ne hai fatta una "',t.loseExpression().label,'"!')}}function N(n,g){n&1&&(c(0,"h1"),l(1,"Hai vinto!"),a())}function G(n,g){n&1&&(c(0,"h1"),l(1,"Non riesco a vedere la tua faccia!"),a())}function H(n,g){if(n&1&&(c(0,"h1"),l(1),a()),n&2){let t=m();i(),C("Fai una faccia: ",t.targetExpression().label,"")}}function Q(n,g){n&1&&(c(0,"h1"),l(1,"Bravo! adesso torna con una espressione normale per una nuova sfida"),a())}function U(n,g){if(n&1&&(c(0,"span",7),l(1),a()),n&2){let t=m(2);i(),C("Record: ",t.recordDuration(),"")}}function W(n,g){if(n&1&&(c(0,"div",3)(1,"span",6),l(2),a(),x(3,U,2,1,"span",7),a()),n&2){let t=m();i(),M("background",t.matchDuration()>t.recordDuration()?"green":"blue"),i(),C("Espressioni: ",t.matchDuration(),""),i(),d(t.recordDuration()?3:-1)}}var k="expression-training-duration",v=[{expression:"happy",label:"felice"},{expression:"sad",label:"triste"},{expression:"angry",label:"arrabbiata"},{expression:"fearful",label:"spaventata"},{expression:"disgusted",label:"disgustata"},{expression:"surprised",label:"sorpresa"}],ee=(()=>{class n{constructor(){this.windowService=f(V),this.elRef=f(O),this.destroyRef=f(D),this.cameraDetection=P("cameraDetection"),this.neutralRequested=o(!1),this.faceDetected=o(!1),this.detectionReady=o(!1),this.endMatch=o(!1),this.loseMatch=o(!1),this.winMatch=o(!1),this.width=o(0),this.height=o(0),this.matchDuration=o(0),this.recordDuration=o(0),this.targetExpression=o(b(v)),this.loseExpression=o(null),this.recordDuration.set(this.getLocalStorageDuration())}ngOnInit(){this.windowService.viewPortChanges.pipe(F(this.destroyRef)).subscribe(()=>{this.doResize()})}onDetectionReady(t){this.detectionReady.set(!0),this.doThirdPartyOnReady()}onDetectionFace(t){this.faceDetected.set(t)}doThirdPartyOnReady(){this.doResize()}onDetectionChanges(t){if(this.doResize(),t){let r=null,e=null;for(let s of v){let h=t[s.expression];s.expression===this.targetExpression().expression?h>.4&&(r=s):h>.94&&(e=s)}if(e){this.loseExpression.set(e),this.endGame(!1);return}r?(this.neutralRequested()||(q(),this.matchDuration.update(s=>s+1)),this.neutralRequested.set(!0)):this.neutralRequested()&&t.neutral>.6&&(this.targetExpression.set(b(v)),this.neutralRequested.set(!1))}}endGame(t){this.endMatch()||(this.winMatch.set(t),this.loseMatch.set(!this.winMatch()),this.endMatch.set(!0),this.cameraDetection().pauseVideo(),window.navigator.vibrate(200),this.matchDuration()>this.recordDuration()&&this.setLocalStorageDuration(this.matchDuration()))}doResize(){this.width.set(this.elRef.nativeElement.clientWidth-1),this.height.set(this.elRef.nativeElement.clientHeight-1)}getLocalStorageDuration(){return+localStorage.getItem(k)}setLocalStorageDuration(t){localStorage.setItem(k,t.toString())}static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275cmp=w({type:n,selectors:[["app-expression-training"]],viewQuery:function(r,e){r&1&&T(e.cameraDetection,A,5),r&2&&S()},decls:11,vars:14,consts:[["cameraDetection",""],[1,"game-container"],[1,"info"],[1,"badge-container"],[1,"webcam"],[3,"detectionReady","detectionChanges","detectionFace","width","height","drawDetection","detectionTimer"],[1,"badge","badge-duration"],[1,"badge","badge-record-duration"]],template:function(r,e){if(r&1){let s=y();c(0,"div",1)(1,"div",2),x(2,L,2,2,"h1")(3,N,2,0,"h1")(4,G,2,0,"h1")(5,H,2,1,"h1")(6,Q,2,0,"h1")(7,W,4,4,"div",3),a(),c(8,"div",4)(9,"app-camera-detection",5,0),R("detectionReady",function(p){return u(s),_(e.onDetectionReady(p))})("detectionChanges",function(p){return u(s),_(e.onDetectionChanges(p))})("detectionFace",function(p){return u(s),_(e.onDetectionFace(p))}),a()()()}r&2&&(M("width",e.width(),"px")("height",e.height(),"px"),i(2),d(e.endMatch()&&e.loseMatch()?2:-1),i(),d(e.endMatch()&&e.winMatch()?3:-1),i(),d(e.detectionReady()&&!e.endMatch()&&!e.faceDetected()?4:-1),i(),d(e.faceDetected()&&!e.endMatch()&&!e.neutralRequested()?5:-1),i(),d(e.faceDetected()&&!e.endMatch()&&e.neutralRequested()?6:-1),i(),d(e.faceDetected()||e.endMatch()?7:-1),i(2),E("width",e.width())("height",e.height())("drawDetection",!0)("detectionTimer",100))},dependencies:[z],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.game-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto;width:100%;height:100%;overflow:hidden}.game-container[_ngcontent-%COMP%]   .youtube[_ngcontent-%COMP%], .game-container[_ngcontent-%COMP%]   .webcam[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{width:100%;color:#000;position:absolute;bottom:10px;text-align:center;z-index:10000}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{background-color:#fff;padding:3px;border-radius:3px;margin-bottom:5px;display:inline}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]{width:100%}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{padding:3px;border-radius:3px;white-space:nowrap}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-happy[_ngcontent-%COMP%]{color:#fff}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-record-duration[_ngcontent-%COMP%], .game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-duration[_ngcontent-%COMP%]{margin-left:5px}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-duration[_ngcontent-%COMP%]{color:#fff}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-record-duration[_ngcontent-%COMP%]{background:#ff0;color:#000}"],changeDetection:0})}}return n})();export{ee as ExpressionTrainingComponent};
