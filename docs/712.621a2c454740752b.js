"use strict";(self.webpackChunktry_not_to_laugh=self.webpackChunktry_not_to_laugh||[]).push([[712],{712:(R,g,s)=>{s.r(g),s.d(g,{ExpressionTrainingModule:()=>v});var l=s(6814),p=s(4581),d=s(4349),e=s(9212),u=s(5027),f=s(7231);const m=["cameraDetection"];function _(n,c){if(1&n&&(e.TgZ(0,"h1"),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.AsE('Hai perso, dovevi fare una faccia "',t.targetExpression.label,'" invece ne hai fatta una "',t.loseExpression.label,'"!')}}function C(n,c){1&n&&(e.TgZ(0,"h1"),e._uU(1,"Hai vinto!"),e.qZA())}function x(n,c){1&n&&(e.TgZ(0,"h1"),e._uU(1,"Non riesco a vedere la tua faccia!"),e.qZA())}function M(n,c){if(1&n&&(e.TgZ(0,"h1"),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.hij("Fai una faccia: ",t.targetExpression.label,"")}}function T(n,c){1&n&&(e.TgZ(0,"h1"),e._uU(1,"Bravo! adesso torna con una espressione normale per una nuova sfida"),e.qZA())}function O(n,c){if(1&n&&(e.TgZ(0,"span",10),e._uU(1),e.qZA()),2&n){const t=e.oxw(2);e.xp6(1),e.hij("Record: ",t.recordDuration,"")}}function y(n,c){if(1&n&&(e.TgZ(0,"div",7)(1,"span",8),e._uU(2),e.qZA(),e.YNc(3,O,2,1,"span",9),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Udp("background",t.matchDuration>t.recordDuration?"green":"blue"),e.xp6(1),e.hij("Espressioni: ",t.matchDuration,""),e.xp6(1),e.Q6J("ngIf",t.recordDuration)}}const h=[{expression:"happy",label:"felice"},{expression:"sad",label:"triste"},{expression:"angry",label:"arrabbiata"},{expression:"fearful",label:"spaventata"},{expression:"disgusted",label:"disgustata"},{expression:"surprised",label:"sorpresa"}],D=[{path:"",component:(()=>{class n{constructor(t,o,i){this.cdr=t,this.windowService=o,this.elRef=i,this.targetExpression=(0,d.US)(h),this.neutralRequested=!1,this.faceDetected=!1,this.firstDetectionHappen=!1,this.detectionReady=!1,this.allReady=!1,this.endMatch=!1,this.loseMatch=!1,this.winMatch=!1,this.readyToGame=!1,this.width=0,this.height=0,this.recordDuration=0,this.matchDuration=0,this.recordDuration=this.getLocalStorageDuration()}ngOnInit(){this.subVwChanges=this.windowService.viewPortChanges.subscribe(()=>{this.doResize()})}ngOnDestroy(){(0,d.P$)(this.subVwChanges)}onDetectionReady(t){this.detectionReady=!0,this.doThirdPartyOnReady()}onFirstDetection(t){this.firstDetectionHappen=t}onDetectionFace(t){this.faceDetected=t}doThirdPartyOnReady(){this.allReady=this.detectionReady,this.doResize()}onDetectionChanges(t){if(this.doResize(),t){let o=null,i=null;for(const a of h){const r=t[a.expression];a.expression===this.targetExpression.expression?r>.4&&(o=a):r>.94&&(i=a)}if(i)return this.loseExpression=i,void this.endGame(!1);o?(this.neutralRequested||((0,d.Vp)(),this.matchDuration++),this.neutralRequested=!0):this.neutralRequested&&t.neutral>.6&&(this.targetExpression=(0,d.US)(h),this.neutralRequested=!1)}this.manageReadyToGameState()}endGame(t){this.endMatch||(this.winMatch=t,this.loseMatch=!this.winMatch,this.endMatch=!0,this.cameraDetection.pauseVideo(),window.navigator.vibrate(200),this.manageReadyToGameState(),this.matchDuration>this.recordDuration&&this.setLocalStorageDuration(this.matchDuration),this.cdr.markForCheck())}manageReadyToGameState(){const t=!this.endMatch&&this.faceDetected;this.readyToGame!==t&&(this.readyToGame=t,this.cdr.markForCheck())}doResize(){const t=this.elRef.nativeElement.clientWidth-1,o=this.elRef.nativeElement.clientHeight-1;(t!==this.width||o!==this.height)&&(this.width=t,this.height=o,this.cdr.markForCheck())}getLocalStorageDuration(){return+localStorage.getItem("expression-training-duration")}setLocalStorageDuration(t){localStorage.setItem("expression-training-duration",t.toString())}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(e.sBO),e.Y36(u.u),e.Y36(e.SBq))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["app-expression-training"]],viewQuery:function(o,i){if(1&o&&e.Gf(m,5),2&o){let a;e.iGM(a=e.CRH())&&(i.cameraDetection=a.first)}},decls:11,vars:14,consts:[[1,"game-container"],[1,"info"],[4,"ngIf"],["class","badge-container",4,"ngIf"],[1,"webcam"],[3,"width","height","drawDetection","detectionTimer","detectionReady","detectionChanges","firstDetection","detectionFace"],["cameraDetection",""],[1,"badge-container"],[1,"badge","badge-duration"],["class","badge badge-record-duration",4,"ngIf"],[1,"badge","badge-record-duration"]],template:function(o,i){1&o&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,_,2,2,"h1",2)(3,C,2,0,"h1",2)(4,x,2,0,"h1",2)(5,M,2,1,"h1",2)(6,T,2,0,"h1",2)(7,y,4,4,"div",3),e.qZA(),e.TgZ(8,"div",4)(9,"app-camera-detection",5,6),e.NdJ("detectionReady",function(r){return i.onDetectionReady(r)})("detectionChanges",function(r){return i.onDetectionChanges(r)})("firstDetection",function(r){return i.onFirstDetection(r)})("detectionFace",function(r){return i.onDetectionFace(r)}),e.qZA()()()),2&o&&(e.Udp("width",i.width,"px")("height",i.height,"px"),e.xp6(2),e.Q6J("ngIf",i.endMatch&&i.loseMatch),e.xp6(1),e.Q6J("ngIf",i.endMatch&&i.winMatch),e.xp6(1),e.Q6J("ngIf",i.detectionReady&&!i.endMatch&&!i.faceDetected),e.xp6(1),e.Q6J("ngIf",i.faceDetected&&!i.endMatch&&!i.neutralRequested),e.xp6(1),e.Q6J("ngIf",i.faceDetected&&!i.endMatch&&i.neutralRequested),e.xp6(1),e.Q6J("ngIf",i.faceDetected||i.endMatch),e.xp6(2),e.Q6J("width",i.width)("height",i.height)("drawDetection",!0)("detectionTimer",100))},dependencies:[l.O5,f.w],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.game-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto;width:100%;height:100%;overflow:hidden}.game-container[_ngcontent-%COMP%]   .youtube[_ngcontent-%COMP%], .game-container[_ngcontent-%COMP%]   .webcam[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{width:100%;color:#000;position:absolute;bottom:10px;text-align:center;z-index:10000}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{background-color:#fff;padding:3px;border-radius:3px;margin-bottom:5px;display:inline}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]{width:100%}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{padding:3px;border-radius:3px;white-space:nowrap}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-happy[_ngcontent-%COMP%]{color:#fff}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-record-duration[_ngcontent-%COMP%], .game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-duration[_ngcontent-%COMP%]{margin-left:5px}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-duration[_ngcontent-%COMP%]{color:#fff}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-record-duration[_ngcontent-%COMP%]{background:yellow;color:#000}"]})}return n})()}];let P=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#n=this.\u0275inj=e.cJS({imports:[p.Bz.forChild(D),p.Bz]})}return n})();var b=s(531),w=s(7741);let v=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#n=this.\u0275inj=e.cJS({imports:[l.ez,P,b.u,w.L]})}return n})()}}]);