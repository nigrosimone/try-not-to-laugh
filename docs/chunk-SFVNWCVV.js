import{a as G,b as I}from"./chunk-IVJT6XWX.js";import{a as M,b as F,c as V}from"./chunk-LQ6HXUU3.js";import"./chunk-MCTKNP22.js";import{Ab as E,Bb as T,Db as d,Fb as _,Gb as R,Ma as i,Nb as S,Sa as w,Wa as O,Y as u,bb as C,ca as p,da as m,hb as v,ib as x,lb as c,mb as r,nb as o,pa as b,qb as P,sb as y,tb as f}from"./chunk-OERGSWIL.js";import"./chunk-WWX6BADO.js";var q=["cameraDetection"];function z(n,h){if(n&1&&(r(0,"h1"),d(1),o()),n&2){let e=f();i(),R('Hai perso, dovevi fare una faccia "',e.targetExpression.label,'" invece ne hai fatta una "',e.loseExpression.label,'"!')}}function H(n,h){n&1&&(r(0,"h1"),d(1,"Hai vinto!"),o())}function A(n,h){n&1&&(r(0,"h1"),d(1,"Non riesco a vedere la tua faccia!"),o())}function L(n,h){if(n&1&&(r(0,"h1"),d(1),o()),n&2){let e=f();i(),_("Fai una faccia: ",e.targetExpression.label,"")}}function N(n,h){n&1&&(r(0,"h1"),d(1,"Bravo! adesso torna con una espressione normale per una nuova sfida"),o())}function Q(n,h){if(n&1&&(r(0,"span",7),d(1),o()),n&2){let e=f(2);i(),_("Record: ",e.recordDuration,"")}}function U(n,h){if(n&1&&(r(0,"div",3)(1,"span",6),d(2),o(),C(3,Q,2,1,"span",7),o()),n&2){let e=f();i(),x("background",e.matchDuration>e.recordDuration?"green":"blue"),i(),_("Espressioni: ",e.matchDuration,""),i(),c(e.recordDuration?3:-1)}}var k="expression-training-duration",D=[{expression:"happy",label:"felice"},{expression:"sad",label:"triste"},{expression:"angry",label:"arrabbiata"},{expression:"fearful",label:"spaventata"},{expression:"disgusted",label:"disgustata"},{expression:"surprised",label:"sorpresa"}],J=(()=>{class n{constructor(){this.cdr=u(S),this.windowService=u(G),this.elRef=u(b),this.cameraDetection=w("cameraDetection"),this.targetExpression=M(D),this.neutralRequested=!1,this.faceDetected=!1,this.firstDetectionHappen=!1,this.detectionReady=!1,this.allReady=!1,this.endMatch=!1,this.loseMatch=!1,this.winMatch=!1,this.readyToGame=!1,this.width=0,this.height=0,this.recordDuration=0,this.matchDuration=0,this.recordDuration=this.getLocalStorageDuration()}ngOnInit(){this.subVwChanges=this.windowService.viewPortChanges.subscribe(()=>{this.doResize()})}ngOnDestroy(){F(this.subVwChanges)}onDetectionReady(e){this.detectionReady=!0,this.doThirdPartyOnReady()}onFirstDetection(e){this.firstDetectionHappen=e}onDetectionFace(e){this.faceDetected=e}doThirdPartyOnReady(){this.allReady=this.detectionReady,this.doResize()}onDetectionChanges(e){if(this.doResize(),e){let a=null,t=null;for(let s of D){let g=e[s.expression];s.expression===this.targetExpression.expression?g>.4&&(a=s):g>.94&&(t=s)}if(t){this.loseExpression=t,this.endGame(!1);return}a?(this.neutralRequested||(V(),this.matchDuration++),this.neutralRequested=!0):this.neutralRequested&&e.neutral>.6&&(this.targetExpression=M(D),this.neutralRequested=!1)}this.manageReadyToGameState()}endGame(e){this.endMatch||(this.winMatch=e,this.loseMatch=!this.winMatch,this.endMatch=!0,this.cameraDetection().pauseVideo(),window.navigator.vibrate(200),this.manageReadyToGameState(),this.matchDuration>this.recordDuration&&this.setLocalStorageDuration(this.matchDuration),this.cdr.markForCheck())}manageReadyToGameState(){let e=!this.endMatch&&this.faceDetected;this.readyToGame!==e&&(this.readyToGame=e,this.cdr.markForCheck())}doResize(){let e=this.elRef.nativeElement.clientWidth-1,a=this.elRef.nativeElement.clientHeight-1;(e!==this.width||a!==this.height)&&(this.width=e,this.height=a,this.cdr.markForCheck())}getLocalStorageDuration(){return+localStorage.getItem(k)}setLocalStorageDuration(e){localStorage.setItem(k,e.toString())}static{this.\u0275fac=function(a){return new(a||n)}}static{this.\u0275cmp=O({type:n,selectors:[["app-expression-training"]],viewQuery:function(a,t){a&1&&E(t.cameraDetection,q,5),a&2&&T()},decls:11,vars:14,consts:[["cameraDetection",""],[1,"game-container"],[1,"info"],[1,"badge-container"],[1,"webcam"],[3,"detectionReady","detectionChanges","firstDetection","detectionFace","width","height","drawDetection","detectionTimer"],[1,"badge","badge-duration"],[1,"badge","badge-record-duration"]],template:function(a,t){if(a&1){let s=P();r(0,"div",1)(1,"div",2),C(2,z,2,2,"h1")(3,H,2,0,"h1")(4,A,2,0,"h1")(5,L,2,1,"h1")(6,N,2,0,"h1")(7,U,4,4,"div",3),o(),r(8,"div",4)(9,"app-camera-detection",5,0),y("detectionReady",function(l){return p(s),m(t.onDetectionReady(l))})("detectionChanges",function(l){return p(s),m(t.onDetectionChanges(l))})("firstDetection",function(l){return p(s),m(t.onFirstDetection(l))})("detectionFace",function(l){return p(s),m(t.onDetectionFace(l))}),o()()()}a&2&&(x("width",t.width,"px")("height",t.height,"px"),i(2),c(t.endMatch&&t.loseMatch?2:-1),i(),c(t.endMatch&&t.winMatch?3:-1),i(),c(t.detectionReady&&!t.endMatch&&!t.faceDetected?4:-1),i(),c(t.faceDetected&&!t.endMatch&&!t.neutralRequested?5:-1),i(),c(t.faceDetected&&!t.endMatch&&t.neutralRequested?6:-1),i(),c(t.faceDetected||t.endMatch?7:-1),i(2),v("width",t.width)("height",t.height)("drawDetection",!0)("detectionTimer",100))},dependencies:[I],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.game-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto;width:100%;height:100%;overflow:hidden}.game-container[_ngcontent-%COMP%]   .youtube[_ngcontent-%COMP%], .game-container[_ngcontent-%COMP%]   .webcam[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{width:100%;color:#000;position:absolute;bottom:10px;text-align:center;z-index:10000}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{background-color:#fff;padding:3px;border-radius:3px;margin-bottom:5px;display:inline}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]{width:100%}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{padding:3px;border-radius:3px;white-space:nowrap}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-happy[_ngcontent-%COMP%]{color:#fff}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-record-duration[_ngcontent-%COMP%], .game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-duration[_ngcontent-%COMP%]{margin-left:5px}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-duration[_ngcontent-%COMP%]{color:#fff}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-record-duration[_ngcontent-%COMP%]{background:#ff0;color:#000}"]})}}return n})();export{J as ExpressionTrainingComponent};
