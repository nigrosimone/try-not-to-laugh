"use strict";(self.webpackChunktry_not_to_laugh=self.webpackChunktry_not_to_laugh||[]).push([[550],{1550:(R,g,r)=>{r.r(g),r.d(g,{ExpressionTrainingModule:()=>w});var h=r(6895),l=r(1791),c=r(2768),e=r(4650),u=r(5027),f=r(1034);const m=["cameraDetection"];function _(t,o){if(1&t&&(e.TgZ(0,"h1"),e._uU(1),e.qZA()),2&t){const n=e.oxw();e.xp6(1),e.AsE('Hai perso, dovevi fare una faccia "',n.targetExpression.label,'" invece ne hai fatta una "',n.loseExpression.label,'"!')}}function x(t,o){1&t&&(e.TgZ(0,"h1"),e._uU(1,"Hai vinto!"),e.qZA())}function C(t,o){1&t&&(e.TgZ(0,"h1"),e._uU(1,"Non riesco a vedere la tua faccia!"),e.qZA())}function M(t,o){if(1&t&&(e.TgZ(0,"h1"),e._uU(1),e.qZA()),2&t){const n=e.oxw();e.xp6(1),e.hij("Fai una faccia: ",n.targetExpression.label,"")}}function T(t,o){1&t&&(e.TgZ(0,"h1"),e._uU(1,"Bravo! adesso torna con una espressione normale per una nuova sfida"),e.qZA())}function O(t,o){if(1&t&&(e.TgZ(0,"span",10),e._uU(1),e.qZA()),2&t){const n=e.oxw(2);e.xp6(1),e.hij("Record: ",n.recordDuration,"")}}function y(t,o){if(1&t&&(e.TgZ(0,"div",7)(1,"span",8),e._uU(2),e.qZA(),e.YNc(3,O,2,1,"span",9),e.qZA()),2&t){const n=e.oxw();e.xp6(1),e.Udp("background",n.matchDuration>n.recordDuration?"green":"blue"),e.xp6(1),e.hij("Espressioni: ",n.matchDuration,""),e.xp6(1),e.Q6J("ngIf",n.recordDuration)}}const d=[{expression:"happy",label:"felice"},{expression:"sad",label:"triste"},{expression:"angry",label:"arrabbiata"},{expression:"fearful",label:"spaventata"},{expression:"disgusted",label:"disgustata"},{expression:"surprised",label:"sorpresa"}],D=[{path:"",component:(()=>{class t{constructor(n,i,a){this.cdr=n,this.windowService=i,this.elRef=a,this.targetExpression=(0,c.US)(d),this.neutralRequested=!1,this.faceDetected=!1,this.firstDetectionHappen=!1,this.detectionReady=!1,this.allReady=!1,this.endMatch=!1,this.loseMatch=!1,this.winMatch=!1,this.readyToGame=!1,this.width=0,this.height=0,this.recordDuration=0,this.matchDuration=0,this.recordDuration=this.getLocalStorageDuration()}ngOnInit(){this.subVwChanges=this.windowService.viewPortChanges.subscribe(()=>{this.doResize()})}ngOnDestroy(){(0,c.P$)(this.subVwChanges)}onDetectionReady(n){this.detectionReady=!0,this.doThirdPartyOnReady()}onFirstDetection(n){this.firstDetectionHappen=n}onDetectionFace(n){this.faceDetected=n}doThirdPartyOnReady(){this.allReady=this.detectionReady,this.doResize()}onDetectionChanges(n){if(this.doResize(),n){let i=null,a=null;for(const s of d){const p=n[s.expression];s.expression===this.targetExpression.expression?p>.4&&(i=s):p>.94&&(a=s)}if(a)return this.loseExpression=a,void this.endGame(!1);i?(this.neutralRequested||((0,c.Vp)(),this.matchDuration++),this.neutralRequested=!0):this.neutralRequested&&n.neutral>.6&&(this.targetExpression=(0,c.US)(d),this.neutralRequested=!1)}this.manageReadyToGameState()}endGame(n){this.endMatch||(this.winMatch=n,this.loseMatch=!this.winMatch,this.endMatch=!0,this.cameraDetection.pauseVideo(),window.navigator.vibrate(200),this.manageReadyToGameState(),this.matchDuration>this.recordDuration&&this.setLocalStorageDuration(this.matchDuration),this.cdr.markForCheck())}manageReadyToGameState(){const n=!this.endMatch&&this.faceDetected;this.readyToGame!==n&&(this.readyToGame=n,this.cdr.markForCheck())}doResize(){const n=this.elRef.nativeElement.clientWidth-1,i=this.elRef.nativeElement.clientHeight-1;(n!==this.width||i!==this.height)&&(this.width=n,this.height=i,this.cdr.markForCheck())}getLocalStorageDuration(){return+localStorage.getItem("expression-training-duration")}setLocalStorageDuration(n){localStorage.setItem("expression-training-duration",n.toString())}}return t.\u0275fac=function(n){return new(n||t)(e.Y36(e.sBO),e.Y36(u.u),e.Y36(e.SBq))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-expression-training"]],viewQuery:function(n,i){if(1&n&&e.Gf(m,5),2&n){let a;e.iGM(a=e.CRH())&&(i.cameraDetection=a.first)}},decls:11,vars:14,consts:[[1,"game-container"],[1,"info"],[4,"ngIf"],["class","badge-container",4,"ngIf"],[1,"webcam"],[3,"width","height","drawDetection","detectionTimer","detectionReady","detectionChanges","firstDetection","detectionFace"],["cameraDetection",""],[1,"badge-container"],[1,"badge","badge-duration"],["class","badge badge-record-duration",4,"ngIf"],[1,"badge","badge-record-duration"]],template:function(n,i){1&n&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,_,2,2,"h1",2),e.YNc(3,x,2,0,"h1",2),e.YNc(4,C,2,0,"h1",2),e.YNc(5,M,2,1,"h1",2),e.YNc(6,T,2,0,"h1",2),e.YNc(7,y,4,4,"div",3),e.qZA(),e.TgZ(8,"div",4)(9,"app-camera-detection",5,6),e.NdJ("detectionReady",function(s){return i.onDetectionReady(s)})("detectionChanges",function(s){return i.onDetectionChanges(s)})("firstDetection",function(s){return i.onFirstDetection(s)})("detectionFace",function(s){return i.onDetectionFace(s)}),e.qZA()()()),2&n&&(e.Udp("width",i.width+"px")("height",i.height+"px"),e.xp6(2),e.Q6J("ngIf",i.endMatch&&i.loseMatch),e.xp6(1),e.Q6J("ngIf",i.endMatch&&i.winMatch),e.xp6(1),e.Q6J("ngIf",i.detectionReady&&!i.endMatch&&!i.faceDetected),e.xp6(1),e.Q6J("ngIf",i.faceDetected&&!i.endMatch&&!i.neutralRequested),e.xp6(1),e.Q6J("ngIf",i.faceDetected&&!i.endMatch&&i.neutralRequested),e.xp6(1),e.Q6J("ngIf",i.faceDetected||i.endMatch),e.xp6(2),e.Q6J("width",i.width)("height",i.height)("drawDetection",!0)("detectionTimer",100))},dependencies:[h.O5,f.w],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.game-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto;width:100%;height:100%;overflow:hidden}.game-container[_ngcontent-%COMP%]   .youtube[_ngcontent-%COMP%], .game-container[_ngcontent-%COMP%]   .webcam[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{width:100%;color:#000;position:absolute;bottom:10px;text-align:center;z-index:10000}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{background-color:#fff;padding:3px;border-radius:3px;margin-bottom:5px;display:inline}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]{width:100%}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{padding:3px;border-radius:3px;white-space:nowrap}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-happy[_ngcontent-%COMP%]{color:#fff}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-record-duration[_ngcontent-%COMP%], .game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-duration[_ngcontent-%COMP%]{margin-left:5px}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-duration[_ngcontent-%COMP%]{color:#fff}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-record-duration[_ngcontent-%COMP%]{background:yellow;color:#000}"]}),t})()}];let P=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[l.Bz.forChild(D),l.Bz]}),t})();var b=r(6453),E=r(5960);let w=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[h.ez,P,b.u,E.L]}),t})()}}]);