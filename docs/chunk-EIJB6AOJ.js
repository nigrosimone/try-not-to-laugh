import{a as b,b as F}from"./chunk-WJNXT7UM.js";import{a as k,b as z}from"./chunk-2FNU54PD.js";import{a as V}from"./chunk-2PF5J2ZO.js";import"./chunk-IDDSDO5L.js";import{Eb as T,Fb as S,Hb as g,Jb as C,Kb as I,Pa as i,Va as a,Wa as v,Wb as q,Y as f,_a as w,da as u,ea as _,fb as x,ka as O,lb as E,mb as M,pb as l,qb as s,rb as r,sa as P,ub as y,wb as R,xb as m}from"./chunk-FCTBVOYR.js";import"./chunk-HZ6M6AS2.js";var L=["cameraDetection"];function N(n,p){if(n&1&&(s(0,"h1"),g(1),r()),n&2){let t=m();i(),I('Hai perso, dovevi fare una faccia "',t.targetExpression().label,'" invece ne hai fatta una "',t.loseExpression().label,'"!')}}function G(n,p){n&1&&(s(0,"h1"),g(1,"Hai vinto!"),r())}function H(n,p){n&1&&(s(0,"h1"),g(1,"Non riesco a vedere la tua faccia!"),r())}function Q(n,p){if(n&1&&(s(0,"h1"),g(1),r()),n&2){let t=m();i(),C("Fai una faccia: ",t.targetExpression().label,"")}}function U(n,p){n&1&&(s(0,"h1"),g(1,"Bravo! adesso torna con una espressione normale per una nuova sfida"),r())}function W(n,p){if(n&1&&(s(0,"span",7),g(1),r()),n&2){let t=m(2);i(),C("Record: ",t.recordDuration(),"")}}function j(n,p){if(n&1&&(s(0,"div",3)(1,"span",6),g(2),r(),x(3,W,2,1,"span",7),r()),n&2){let t=m();i(),M("background",t.matchDuration()>t.recordDuration()?"green":"blue"),i(),C("Espressioni: ",t.matchDuration(),""),i(),l(t.recordDuration()?3:-1)}}var A="expression-training-duration",D=[{expression:"happy",label:"felice"},{expression:"sad",label:"triste"},{expression:"angry",label:"arrabbiata"},{expression:"fearful",label:"spaventata"},{expression:"disgusted",label:"disgustata"},{expression:"surprised",label:"sorpresa"}],te=(()=>{class n{constructor(){this.windowService=f(k),this.elRef=f(P),this.destroyRef=f(O),this.cameraDetection=v("cameraDetection"),this.neutralRequested=a(!1),this.faceDetected=a(!1),this.detectionReady=a(!1),this.endMatch=a(!1),this.loseMatch=q(()=>!this.winMatch()),this.winMatch=a(!1),this.width=a(0),this.height=a(0),this.matchDuration=a(0),this.recordDuration=a(0),this.targetExpression=a(b(D)),this.loseExpression=a(null),this.recordDuration.set(this.getLocalStorageDuration())}ngOnInit(){this.windowService.viewPortChanges.pipe(V(this.destroyRef)).subscribe(()=>{this.doResize()})}onDetectionReady(t){this.detectionReady.set(!0),this.doThirdPartyOnReady()}onDetectionFace(t){this.faceDetected.set(t)}doThirdPartyOnReady(){this.doResize()}onDetectionChanges(t){if(this.doResize(),!t)return;let o=null,e=null,h=this.targetExpression().expression;for(let c of D){let d=t[c.expression];if(c.expression===h){if(d>.4){o=c;break}}else if(d>.94){e=c;break}}if(e){this.loseExpression.set(e),this.endGame(!1);return}o?(this.neutralRequested()||(F(),this.matchDuration.update(c=>c+1)),this.neutralRequested.set(!0)):this.neutralRequested()&&t.neutral>.6&&(this.targetExpression.set(b(D)),this.neutralRequested.set(!1))}endGame(t){this.endMatch()||(this.winMatch.set(t),this.endMatch.set(!0),this.cameraDetection().pauseVideo(),window.navigator.vibrate(200),this.matchDuration()>this.recordDuration()&&this.setLocalStorageDuration(this.matchDuration()))}doResize(){let{clientWidth:t,clientHeight:o}=this.elRef.nativeElement;this.width.set(t-1),this.height.set(o-1)}getLocalStorageDuration(){return+localStorage.getItem(A)}setLocalStorageDuration(t){localStorage.setItem(A,t.toString())}static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275cmp=w({type:n,selectors:[["app-expression-training"]],viewQuery:function(o,e){o&1&&T(e.cameraDetection,L,5),o&2&&S()},decls:11,vars:13,consts:[["cameraDetection",""],[1,"game-container"],[1,"info"],[1,"badge-container"],[1,"webcam"],[3,"detectionReady","detectionChanges","detectionFace","width","height","drawDetection"],[1,"badge","badge-duration"],[1,"badge","badge-record-duration"]],template:function(o,e){if(o&1){let h=y();s(0,"div",1)(1,"div",2),x(2,N,2,2,"h1")(3,G,2,0,"h1")(4,H,2,0,"h1")(5,Q,2,1,"h1")(6,U,2,0,"h1")(7,j,4,4,"div",3),r(),s(8,"div",4)(9,"app-camera-detection",5,0),R("detectionReady",function(d){return u(h),_(e.onDetectionReady(d))})("detectionChanges",function(d){return u(h),_(e.onDetectionChanges(d))})("detectionFace",function(d){return u(h),_(e.onDetectionFace(d))}),r()()()}o&2&&(M("width",e.width(),"px")("height",e.height(),"px"),i(2),l(e.endMatch()&&e.loseMatch()?2:-1),i(),l(e.endMatch()&&e.winMatch()?3:-1),i(),l(e.detectionReady()&&!e.endMatch()&&!e.faceDetected()?4:-1),i(),l(e.faceDetected()&&!e.endMatch()&&!e.neutralRequested()?5:-1),i(),l(e.faceDetected()&&!e.endMatch()&&e.neutralRequested()?6:-1),i(),l(e.faceDetected()||e.endMatch()?7:-1),i(2),E("width",e.width())("height",e.height())("drawDetection",!0))},dependencies:[z],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}.game-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto;width:100%;height:100%;overflow:hidden}.game-container[_ngcontent-%COMP%]   .youtube[_ngcontent-%COMP%], .game-container[_ngcontent-%COMP%]   .webcam[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1 1 auto}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{width:100%;color:#000;position:absolute;bottom:10px;text-align:center;z-index:10000}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{background-color:#fff;padding:3px;border-radius:3px;margin-bottom:5px;display:inline}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]{width:100%}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{padding:3px;border-radius:3px;white-space:nowrap}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-happy[_ngcontent-%COMP%]{color:#fff}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-record-duration[_ngcontent-%COMP%], .game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-duration[_ngcontent-%COMP%]{margin-left:5px}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-duration[_ngcontent-%COMP%]{color:#fff}.game-container[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]   .badge-container[_ngcontent-%COMP%]   .badge-record-duration[_ngcontent-%COMP%]{background:#ff0;color:#000}"],changeDetection:0})}}return n})();export{te as ExpressionTrainingComponent};
